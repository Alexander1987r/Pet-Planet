/* empty css              */(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const m of n.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const f=document.createElement("div"),w=document.createElement("div");f.classList.add("loader");w.classList.add("loader__spinner");f.append(w);const J=()=>{document.body.append(f)},M=()=>{f.remove()},P="https://sequoia-half-screen.glitch.me",E=document.querySelector(".store__list"),T=d=>{E.textContent=" ",d.forEach(({id:o,name:i,price:u,photoUrl:s})=>{const n=document.createElement("li");n.classList.add("store__item"),n.innerHTML=`
    <article class="store__product product">
    <h3 class="product__title">${i}</h3>
    <img class="product__image" src="${P}${s}" alt="${i}" width="264" height="229">
    <b class="product__price">${u} ₽</b>
    <button class="product__button" data-id=${o} type="button">
        Заказать
    </button>
    </article>
    `,E.appendChild(n)})},I=async d=>{J();try{const o=await fetch(`${P}//api/products/category/${d}`);if(!o.ok)throw new Error(o.status);const i=await o.json();T(i)}catch(o){console.error(`Ошибка:${o}`)}finally{M()}},S="https://sequoia-half-screen.glitch.me",$=document.querySelectorAll(".store__categories-button"),j=document.querySelector(".store__list"),q=document.querySelector(".store__button"),k=q.querySelector(".store__button-count"),p=document.querySelector(".modal-overlay"),O=p.querySelector(".modal-overlay_button"),_=p.querySelector(".modal__list"),B=p.querySelector(".form__price"),C=document.querySelector(".form"),g=document.createElement("div");g.classList.add("order-message");const L=document.createElement("p");L.classList.add("order-message__text");const y=document.createElement("button");y.classList.add("order-message__close-button");y.textContent="Закрыть";g.append(L,y);y.addEventListener("click",()=>{g.remove()});const F=()=>{const d=({target:o})=>{console.log(o.textContent),$.forEach(i=>{i.classList.remove("store__categories-button_active"),o.classList.add("store__categories-button_active")}),I(o.textContent)};$.forEach(o=>{o.addEventListener("click",d),o.classList.contains("store__categories-button_active")&&I(o.textContent)})},H=()=>{const d=()=>{const e=JSON.parse(localStorage.getItem("products")||"[]");k.textContent=e.length},o=e=>{const t=JSON.parse(localStorage.getItem("products")||"[]"),r=t.find(c=>c.id===e);r?r.count+=1:t.push({id:e,count:1}),localStorage.setItem("products",JSON.stringify(t)),d()};j.addEventListener("click",({target:e})=>{if(e.closest(".product__button")){const t=e.dataset.id;o(t)}}),d();const i=async e=>{try{const t=await fetch(`${S}/api/products/list/${e.join(",")}`);if(!t.ok)throw new Error(t.status);return await t.json()}catch(t){return console.error(`Ошибка:${t}`),[]}},u=(e,t)=>e.reduce((r,c)=>{const a=t.find(l=>l.id===c.id);return r+Number(c.price)*a.count},0),s=async()=>{const e=JSON.parse(localStorage.getItem("products")||"[]"),t=JSON.parse(localStorage.getItem("cartProductsAdd")||"[]");t.forEach(({id:c,name:a,price:l,photoUrl:N})=>{const h=e.find(A=>A.id===c);if(!h)return;const b=document.createElement("li");b.classList.add("modal__item"),b.innerHTML=`
            <h3 class="modal__item-title">
             ${a} 
            </h3>
            <img class="modal__item-image" src="${S}${N}" alt="${a}" width="54" height="54">
            <div class="modal__item-buttons">
            <button class="modal__item-button modal__item-button_minus" type="button" data-id=${c}>-</button>
            <span class="modal__item-count">${h.count}</span>
            <button class="modal__item-button modal__item-button_plus" type="button" data-id=${c}>+</button>
            </div>
            <p class="modal__item-price">${l*h.count} ₽</p>
            `,_.append(b)});const r=u(t,e);B.innerHTML=`${r} ₽`},n=async()=>{p.style.display="flex",_.textContent="";const t=JSON.parse(localStorage.getItem("products")||"[]").map(c=>c.id);if(!t.length){const c=document.createElement("li");c.textContent="Корзина пуста",_.append(c)}const r=await i(t);localStorage.setItem("cartProductsAdd",JSON.stringify(r)),s(),O.addEventListener("click",m)},m=()=>{p.style.display="none",O.removeEventListener("click",m)};q.addEventListener("click",n);const v=(e,t)=>{const r=JSON.parse(localStorage.getItem("products")||"[]");console.log(r);const c=r.findIndex(a=>a.id===e);c!==-1&&(r[c].count+=t),r[c].count<=0&&r.splice(c,1),localStorage.setItem("products",JSON.stringify(r)),_.textContent="",d(),s()};_.addEventListener("click",({target:e})=>{if(e.classList.contains("modal__item-button_plus")){const t=e.dataset.id;console.log(t),v(t,1)}if(e.classList.contains("modal__item-button_minus")){const t=e.dataset.id;v(t,-1)}});const x=async e=>{e.preventDefault();const t=C.store.value,r=JSON.parse(localStorage.getItem("products")||"[]");console.log(r);const c=r.map(({id:a,count:l})=>({id:a,quantity:l}));try{const a=await fetch(`${S}/api/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeId:t,products:r})});if(!a.ok)throw new Error(a.status);localStorage.removeItem("products"),localStorage.removeItem("cartProductsAdd");const{orderId:l}=await a.json();L.textContent=`Ваш заказ оформлен,номер ${l}.Вы можете его забрать`,document.body.append(g),p.style.display="none",d()}catch(a){console.error(`Ошибка оформления заказа:${a}`)}console.log("prodOrder",c)};C.addEventListener("submit",x)};document.querySelectorAll(".store__categories-button");H();F();
