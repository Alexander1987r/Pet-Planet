/* empty css              */(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const _=document.createElement("div"),I=document.createElement("div");_.classList.add("loader");I.classList.add("loader__spinner");_.append(I);const q=()=>{document.body.append(_)},w=()=>{_.remove()},E="https://sequoia-half-screen.glitch.me",b=document.querySelector(".store__list"),A=a=>{b.textContent=" ",a.forEach(({id:o,name:i,price:d,photoUrl:s})=>{const r=document.createElement("li");r.classList.add("store__item"),r.innerHTML=`
    <article class="store__product product">
    <h3 class="product__title">${i}</h3>
    <img class="product__image" src="${E}${s}" alt="${i}" width="264" height="229">
    <b class="product__price">${d} ₽</b>
    <button class="product__button" data-id=${o} type="button">
        Заказать
    </button>
    </article>
    `,b.appendChild(r)})},S=async a=>{q();try{const o=await fetch(`${E}//api/products/category/${a}`);if(!o.ok)throw new Error(o.status);const i=await o.json();A(i)}catch(o){console.error(`Ошибка:${o}`)}finally{w()}},L="https://sequoia-half-screen.glitch.me",v=document.querySelectorAll(".store__categories-button"),N=document.querySelector(".store__list"),C=document.querySelector(".store__button"),x=C.querySelector(".store__button-count"),p=document.querySelector(".modal-overlay"),$=p.querySelector(".modal-overlay_button"),m=p.querySelector(".modal__list");p.querySelector(".form");const J=p.querySelector(".form__price"),M=()=>{const a=({target:o})=>{console.log(o.textContent),v.forEach(i=>{i.classList.remove("store__categories-button_active"),o.classList.add("store__categories-button_active")}),S(o.textContent)};v.forEach(o=>{o.addEventListener("click",a),o.classList.contains("store__categories-button_active")&&S(o.textContent)})},T=()=>{const a=()=>{const e=JSON.parse(localStorage.getItem("products")||"[]");x.textContent=e.length},o=e=>{const t=JSON.parse(localStorage.getItem("products")||"[]"),n=t.find(c=>c.id===e);n?n.count+=1:t.push({id:e,count:1}),localStorage.setItem("products",JSON.stringify(t)),a()};N.addEventListener("click",({target:e})=>{if(e.closest(".product__button")){const t=e.dataset.id;o(t)}}),a();const i=async e=>{try{const t=await fetch(`${L}/api/products/list/${e.join(",")}`);if(!t.ok)throw new Error(t.status);return await t.json()}catch(t){return console.error(`Ошибка:${t}`),[]}},d=(e,t)=>e.reduce((n,c)=>{const u=t.find(f=>f.id===c.id);return n+Number(c.price)*u.count},0),s=async()=>{const e=JSON.parse(localStorage.getItem("products")||"[]"),t=JSON.parse(localStorage.getItem("cartProductsAdd")||"[]");t.forEach(({id:c,name:u,price:f,photoUrl:O})=>{const g=e.find(P=>P.id===c);if(!g)return;const y=document.createElement("li");y.classList.add("modal__item"),y.innerHTML=`
            <h3 class="modal__item-title">
             ${u} 
            </h3>
            <img class="modal__item-image" src="${L}${O}" alt="${u}" width="54" height="54">
            <div class="modal__item-buttons">
            <button class="modal__item-button modal__item-button_minus" type="button" data-id=${c}>-</button>
            <span class="modal__item-count">${g.count}</span>
            <button class="modal__item-button modal__item-button_plus" type="button" data-id=${c}>+</button>
            </div>
            <p class="modal__item-price">${f*g.count} ₽</p>
            `,m.append(y)});const n=d(t,e);J.innerHTML=`${n} ₽`},r=async()=>{p.style.display="flex",m.textContent="";const t=JSON.parse(localStorage.getItem("products")||"[]").map(c=>c.id);if(!t.length){const c=document.createElement("li");c.textContent="Корзина пуста",m.append(c)}const n=await i(t);localStorage.setItem("cartProductsAdd",JSON.stringify(n)),s(),$.addEventListener("click",l)},l=()=>{p.style.display="none",$.removeEventListener("click",l)};C.addEventListener("click",r);const h=(e,t)=>{const n=JSON.parse(localStorage.getItem("products")||"[]");console.log(n);const c=n.findIndex(u=>u.id===e);c!==-1&&(n[c].count+=t),n[c].count<=0&&n.splice(c,1),localStorage.setItem("products",JSON.stringify(n)),m.textContent="",a(),s()};m.addEventListener("click",({target:e})=>{if(e.classList.contains("modal__item-button_plus")){const t=e.dataset.id;console.log(t),h(t,1)}if(e.classList.contains("modal__item-button_minus")){const t=e.dataset.id;h(t,-1)}})};document.querySelectorAll(".store__categories-button");T();M();
